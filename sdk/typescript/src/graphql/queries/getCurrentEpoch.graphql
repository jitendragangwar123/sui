# Copyright (c) Mysten Labs, Inc.
# SPDX-License-Identifier: Apache-2.0

query getCurrentEpoch {
	epoch {
		epochId
		validatorSet {
			activeValidators {
				...RPC_VALIDATOR_FIELDS
			}
		}
		# epochTotalTransactions
		firstCheckpoint: checkpoints(first: 1) {
			nodes {
				sequenceNumber
			}
		}
		startTimestamp
		endTimestamp
		referenceGasPrice
	}
}

fragment RPC_VALIDATOR_FIELDS on Validator {
	atRisk
	commissionRate
	exchangeRatesSize
	exchangeRates {
		contents {
			json
		}
		asObject {
			address
		}
	}
	description
	gasPrice
	imageUrl
	name
	credentials {
		...RPC_CREDENTIAL_FIELDS
	}
	nextEpochCommissionRate
	nextEpochGasPrice
	nextEpochCredentials {
		...RPC_CREDENTIAL_FIELDS
	}
	nextEpochStake
	nextEpochCommissionRate
	operationCap {
		asObject {
			address
		}
	}
	pendingPoolTokenWithdraw
	pendingStake
	pendingTotalSuiWithdraw
	poolTokenBalance
	projectUrl
	rewardsPool
	stakingPool {
		asObject {
			address
		}
	}
	stakingPoolActivationEpoch
	stakingPoolSuiBalance
	address {
		address
	}
	votingPower
	reportRecords {
		address
	}
}

fragment RPC_CREDENTIAL_FIELDS on ValidatorCredentials {
	netAddress
	networkPubKey
	p2PAddress
	primaryAddress
	workerPubKey
	workerAddress
	proofOfPossession
	protocolPubKey
}
